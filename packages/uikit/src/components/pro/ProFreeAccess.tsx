import styled, { useTheme } from 'styled-components';
import { Body2, Body3, Label1 } from '../Text';
import { useTranslation } from '../../hooks/translation';
import { FreeProAccess, useMutateIsFreeProAccessActivate, useProState } from '../../state/pro';
import { FC } from 'react';
import { ButtonResponsiveSize } from '../fields/Button';
import { NotificationFooter, NotificationFooterPortal } from '../Notification';
import { useDateTimeFormat } from '../../hooks/useDateTimeFormat';

export const ProFreeAccessContent: FC<{
    access: FreeProAccess;
    onSubmit: () => void;
    className?: string;
}> = ({ access, onSubmit, className }) => {
    const { t } = useTranslation();
    const { mutateAsync } = useMutateIsFreeProAccessActivate();
    const { data: pro } = useProState();
    const formatDate = useDateTimeFormat();

    const onClick = async () => {
        await mutateAsync(true);
        onSubmit();
    };

    return (
        <ContentWrapper className={className}>
            <FreeProIcon />
            <Title>
                {t('free_pro_access_page_title', {
                    date: formatDate(access.validUntil, {
                        day: 'numeric',
                        month: 'long'
                    })
                })}
            </Title>
            <Description>{t('free_pro_access_page_description')}</Description>
            <Card>
                <Body2>
                    {t('free_pro_access_page_card_acs_until', {
                        date: formatDate(access.validUntil, {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        })
                    })}
                </Body2>
                <Body3>{t('free')}</Body3>
            </Card>
            <Card>
                <Body3>{t('free_pro_access_page_card_promo_code')}</Body3>
                <Body2>{access.code}</Body2>
            </Card>
            <NotificationFooterPortal>
                <NotificationFooter>
                    {pro?.subscription.valid ? (
                        <ButtonResponsiveSize secondary disabled fullWidth>
                            {t('free_pro_access_page_button_activated')}
                        </ButtonResponsiveSize>
                    ) : (
                        <ButtonResponsiveSize primary onClick={onClick} fullWidth>
                            {t('free_pro_access_page_button_continue')}
                        </ButtonResponsiveSize>
                    )}
                </NotificationFooter>
            </NotificationFooterPortal>
        </ContentWrapper>
    );
};

const ContentWrapper = styled.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 48px 16px 32px;
    box-sizing: border-box;

    > *:last-child {
        width: 100%;
        margin-top: auto;
    }
`;

const Title = styled(Label1)`
    margin-bottom: 4px;
    text-align: center;
`;

const Description = styled(Body2)`
    color: ${p => p.theme.textSecondary};
    text-align: center;
    text-wrap: balance;
    margin-bottom: 32px;
`;

const Card = styled.div`
    width: 100%;
    background-color: ${p => p.theme.backgroundContent};
    border-radius: ${p => p.theme.corner2xSmall};
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    margin-bottom: 16px;

    > ${Body3} {
        color: ${p => p.theme.textSecondary};
    }
`;

const FreeProIcon = () => {
    const theme = useTheme();
    return (
        <svg
            width="326"
            height="180"
            viewBox="0 0 326 180"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <rect
                x="78.5"
                y="42.5"
                width="169"
                height="95"
                rx="27.5"
                fill={theme.backgroundContent}
            />
            <rect x="78.5" y="42.5" width="169" height="95" rx="27.5" stroke={theme.iconTertiary} />
            <path
                d="M114.837 110.445C112.889 110.445 111.72 109.221 111.72 107.217V73.0669C111.72 71.063 112.889 69.8384 114.837 69.8384H126.777C134.57 69.8384 139.998 75.21 139.998 83.0308C139.998 90.8794 134.459 96.2788 126.583 96.2788H117.955V107.217C117.955 109.221 116.758 110.445 114.837 110.445ZM117.955 91.0464H125.107C130.535 91.0464 133.624 88.124 133.624 83.0586C133.624 77.9932 130.535 75.0986 125.135 75.0986H117.955V91.0464ZM148.11 110.529C146.189 110.529 144.993 109.304 144.993 107.3V73.0669C144.993 71.063 146.162 69.8384 148.11 69.8384H160.551C168.817 69.8384 173.966 74.6255 173.966 82.1123C173.966 87.4839 171.127 91.8257 166.312 93.5234L173.103 105.519C173.604 106.382 173.771 106.966 173.771 107.662C173.771 109.304 172.407 110.529 170.598 110.529C169.151 110.529 168.399 110 167.481 108.358L159.938 94.5532H151.227V107.3C151.227 109.304 150.002 110.529 148.11 110.529ZM151.227 89.5156H159.966C164.781 89.5156 167.537 86.8716 167.537 82.2793C167.537 77.7983 164.614 75.0708 159.799 75.0708H151.227V89.5156ZM196.913 110.668C185.334 110.668 178.098 102.708 178.098 89.9331C178.098 77.1582 185.334 69.1704 196.913 69.1704C208.463 69.1704 215.727 77.1582 215.727 89.9331C215.727 102.708 208.463 110.668 196.913 110.668ZM196.913 105.185C204.539 105.185 209.326 99.2847 209.326 89.9331C209.326 80.5537 204.539 74.6533 196.913 74.6533C189.287 74.6533 184.472 80.5537 184.472 89.9331C184.472 99.2847 189.287 105.185 196.913 105.185Z"
                fill="white"
            />
            <path
                d="M67.9199 18.7119C69.0791 17.8552 70.635 17.8011 71.8438 18.5508L72.0801 18.7119C72.4459 18.9824 72.8266 19.5458 73.3125 20.624C73.6711 21.4198 74.0667 22.4445 74.5527 23.7471L75.0703 25.1445C75.3248 25.8323 75.486 26.2706 75.6914 26.6396L75.7822 26.7949C76.098 27.2986 76.5104 27.7335 76.9941 28.0762L77.2051 28.2178C77.5076 28.4073 77.843 28.5486 78.3232 28.7305L78.8555 28.9297C80.8463 29.6664 82.315 30.2094 83.376 30.6875C84.3194 31.1127 84.8691 31.4568 85.1729 31.7812L85.2881 31.9199C86.1448 33.0791 86.1989 34.635 85.4492 35.8438L85.2881 36.0801C85.0176 36.4459 84.4542 36.8266 83.376 37.3125C82.5802 37.6711 81.5555 38.0667 80.2529 38.5527L78.8555 39.0703C78.1677 39.3248 77.7294 39.486 77.3604 39.6914L77.2051 39.7822C76.7014 40.098 76.2665 40.5104 75.9238 40.9941L75.7822 41.2051C75.5927 41.5076 75.4514 41.843 75.2695 42.3232L75.0703 42.8555C74.3336 44.8463 73.7906 46.315 73.3125 47.376C72.8873 48.3194 72.5432 48.8691 72.2188 49.1729L72.0801 49.2881C70.9209 50.1448 69.365 50.1989 68.1562 49.4492L67.9199 49.2881C67.5541 49.0176 67.1734 48.4542 66.6875 47.376C66.3289 46.5802 65.9333 45.5555 65.4473 44.2529L64.9297 42.8555C64.6752 42.1677 64.514 41.7294 64.3086 41.3604L64.2178 41.2051C63.902 40.7014 63.4896 40.2665 63.0059 39.9238L62.7949 39.7822C62.4924 39.5927 62.157 39.4514 61.6768 39.2695L61.1445 39.0703C59.1537 38.3336 57.685 37.7906 56.624 37.3125C55.6806 36.8873 55.1309 36.5432 54.8271 36.2188L54.7119 36.0801C53.8552 34.9209 53.8011 33.365 54.5508 32.1562L54.7119 31.9199C54.9824 31.5541 55.5458 31.1734 56.624 30.6875C57.4198 30.3289 58.4445 29.9333 59.7471 29.4473L61.1445 28.9297C61.8323 28.6752 62.2706 28.514 62.6396 28.3086L62.7949 28.2178C63.2986 27.902 63.7335 27.4896 64.0762 27.0059L64.2178 26.7949C64.4073 26.4924 64.5486 26.157 64.7305 25.6768L64.9297 25.1445C65.6664 23.1537 66.2094 21.685 66.6875 20.624C67.1127 19.6806 67.4568 19.1309 67.7812 18.8271L67.9199 18.7119Z"
                fill={theme.backgroundContent}
                stroke={theme.iconTertiary}
            />
            <path
                d="M252.514 132.634C253.342 132.022 254.453 131.984 255.316 132.52L255.486 132.634C255.732 132.816 256.006 133.211 256.37 134.02C256.548 134.415 256.739 134.887 256.954 135.446L257.686 137.401C257.848 137.84 257.962 138.152 258.093 138.414L258.23 138.662C258.476 139.054 258.797 139.393 259.173 139.659L259.338 139.77C259.496 139.868 259.665 139.951 259.867 140.035L260.599 140.314C262.093 140.868 263.19 141.274 263.98 141.63C264.687 141.948 265.079 142.198 265.287 142.42L265.366 142.514C265.978 143.342 266.016 144.453 265.48 145.316L265.366 145.486C265.184 145.732 264.789 146.006 263.98 146.37C263.585 146.548 263.113 146.739 262.554 146.954L260.599 147.686C260.16 147.848 259.848 147.962 259.586 148.093L259.338 148.23C258.946 148.476 258.607 148.797 258.341 149.173L258.23 149.338C258.132 149.496 258.049 149.665 257.965 149.867L257.686 150.599C257.132 152.093 256.726 153.19 256.37 153.98C256.052 154.687 255.802 155.079 255.58 155.287L255.486 155.366C254.658 155.978 253.547 156.016 252.684 155.48L252.514 155.366C252.268 155.184 251.994 154.789 251.63 153.98C251.452 153.585 251.261 153.113 251.046 152.554L250.314 150.599C250.152 150.16 250.038 149.848 249.907 149.586L249.77 149.338C249.524 148.946 249.203 148.607 248.827 148.341L248.662 148.23C248.504 148.132 248.335 148.049 248.133 147.965L247.401 147.686C245.907 147.132 244.81 146.726 244.02 146.37C243.313 146.052 242.921 145.802 242.713 145.58L242.634 145.486C242.022 144.658 241.984 143.547 242.52 142.684L242.634 142.514C242.816 142.268 243.211 141.994 244.02 141.63C244.415 141.452 244.887 141.261 245.446 141.046L247.401 140.314C247.84 140.152 248.152 140.038 248.414 139.907L248.662 139.77C249.054 139.524 249.393 139.203 249.659 138.827L249.77 138.662C249.868 138.504 249.951 138.335 250.035 138.133L250.314 137.401C250.868 135.907 251.274 134.81 251.63 134.02C251.948 133.313 252.198 132.921 252.42 132.713L252.514 132.634Z"
                fill={theme.backgroundContent}
                stroke={theme.iconTertiary}
            />
            <path
                d="M267.108 114.557C267.605 114.189 268.272 114.167 268.79 114.488L268.892 114.557C269.018 114.65 269.185 114.877 269.428 115.414C269.545 115.674 269.671 115.986 269.813 116.357L270.301 117.659C270.407 117.947 270.487 118.164 270.58 118.352L270.68 118.53C270.855 118.81 271.084 119.052 271.353 119.242L271.47 119.32C271.584 119.392 271.706 119.452 271.848 119.511L272.341 119.699C273.34 120.069 274.065 120.338 274.586 120.572C275.056 120.784 275.288 120.939 275.401 121.059L275.443 121.108C275.811 121.605 275.833 122.272 275.512 122.79L275.443 122.892C275.35 123.018 275.123 123.185 274.586 123.428C274.326 123.545 274.014 123.671 273.643 123.813L272.341 124.301C272.053 124.407 271.836 124.487 271.648 124.58L271.47 124.68C271.19 124.855 270.948 125.084 270.758 125.353L270.68 125.47C270.608 125.584 270.548 125.706 270.489 125.848L270.301 126.341C269.931 127.34 269.662 128.065 269.428 128.586C269.216 129.056 269.061 129.288 268.941 129.401L268.892 129.443C268.395 129.811 267.728 129.833 267.21 129.512L267.108 129.443C266.982 129.35 266.815 129.123 266.572 128.586C266.455 128.326 266.329 128.014 266.187 127.643L265.699 126.341C265.593 126.053 265.513 125.836 265.42 125.648L265.32 125.47C265.145 125.19 264.916 124.948 264.647 124.758L264.53 124.68C264.416 124.608 264.294 124.548 264.152 124.489L263.659 124.301C262.66 123.931 261.935 123.662 261.414 123.428C260.944 123.216 260.712 123.061 260.599 122.941L260.557 122.892C260.189 122.395 260.167 121.728 260.488 121.21L260.557 121.108C260.65 120.982 260.877 120.815 261.414 120.572C261.674 120.455 261.986 120.329 262.357 120.187L263.659 119.699C263.947 119.593 264.164 119.513 264.352 119.42L264.53 119.32C264.81 119.145 265.052 118.916 265.242 118.647L265.32 118.53C265.392 118.416 265.452 118.294 265.511 118.152L265.699 117.659C266.069 116.66 266.338 115.935 266.572 115.414C266.784 114.944 266.939 114.712 267.059 114.599L267.108 114.557Z"
                fill={theme.backgroundContent}
                stroke={theme.iconTertiary}
            />
        </svg>
    );
};
